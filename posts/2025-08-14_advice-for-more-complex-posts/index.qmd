---
title: "Advice for more complex posts"
author: "Charlotte Hadley"
date: "2025-08-15"
categories: [advice, code]
---

As your blogposts become more complex you might feel it's overwhelming having all of your code in the index.qmd file

Great news! It's easy to run a script file from a blogpost using a code chunk that looks like this:

```{{python}}
# | include: false
%run penguins-clustering.py
```

```{python}
# | include: false
%run penguins-clustering.py
```

## Analysis

This script performs a K-Means clustering on the palmer penguins dataset.

Out of `{python} penguins_confusion.sum().sum().item()` penguins, our model misclassified `{python} round(penguins_confusion_mismatch.sum().sum().item() / penguins_confusion.sum().sum().item(), 2) * 100`% of the penguins.

The model has these parameters:

- Number of Clusters: `{python} model_params["n_clusters"]`

- Max Iterations: `{python} model_params["max_iter"]`

This plotnine chart exposes where penguins were misclassified:

```{python}
# | echo: false
#| warning: false
#| message: false
import plotnine as pn


penguins_clust_long_df = pd.melt(penguins_data_df.loc[:, selected_features + ["cluster", "species"]],
                                 id_vars=["bill_length_mm",
                                          "flipper_length_mm"],
                                 var_name="measure",
                                 value_name="group")


pn_scatter_clustering = (
    pn.ggplot(penguins_clust_long_df, pn.aes("bill_length_mm",
                                             "flipper_length_mm", color="factor(group)"))
    + pn.geom_point()
    + pn.facet_wrap("measure")
)
pn_scatter_clustering.save('scatter-clustering.png',
                           width=6, height=4, dpi=300)
```

![](scatter-clustering.png){width="6in" height="4in"}